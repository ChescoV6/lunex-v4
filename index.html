<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Chesco Editor</title>

<style>
    :root {
        --bg-dark: rgb(20,20,20);
        --accent: #6495ed;
        --accent-soft: #3f65aa;
    }

    html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        background: var(--bg-dark);
        color: #fff;
        font-family: Consolas, "Poppins", monospace;
        overflow: hidden;
    }

    #layout {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
    }

    #container {
        width: 100%;
        height: 100%;
        background: var(--bg-dark);
        overflow: hidden;
    }

    .squiggly-error {
        text-decoration: underline wavy #ff4a4a;
        transition: all 0.35s ease-in-out;
    }

    /* Fade animation for selection */
    .monaco-editor .selected-text {
        transition: background-color 0.35s ease, color 0.35s ease;
    }

    /* Smooth folding animation */
    .monaco-editor .view-overlays {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Smooth current line highlight animation */
    .current-line {
        transition: background-color 0.4s ease;
    }
</style>

<script src="vs/loader.js"></script>
</head>
<body>

<div id="layout">
    <div id="container"></div>
</div>

<script>
require.config({ paths: { 'vs': 'vs' } });

let editor;
let Proposals = [];

/* ============================
   LOAD MONACO EDITOR
============================ */
require(["vs/editor/editor.main"], function () {

    /* CUSTOM THEME */
    monaco.editor.defineTheme('DarkChesco', {
        base: "vs-dark",
        inherit: true,
        rules: [
            { token: "keyword", foreground: "6495ed" },
            { token: "string", foreground: "a9c4f5" },
            { token: "comment", foreground: "777777", fontStyle: "italic" },
            { token: "number", foreground: "f08080" },
            { token: "variable", foreground: "ffffff" },
            { token: "operator", foreground: "ffffff" },
            { token: "entity.name.function", foreground: "c0c0c0" }
        ],
        colors: {
            "editor.background": "#141414", // rgb(20,20,20)
            "editorLineNumber.foreground": "#666666",
            "editorCursor.foreground": "#ffffff",
            "editor.selectionBackground": "#2c2c2c",
            "editor.lineHighlightBackground": "#141414", // Make current line same as background
            "minimap.background": "#141414"
        }
    });

    editor = monaco.editor.create(document.getElementById("container"), {
        value: 'print("Made by Chesco")',
        language: "lua",
        theme: "DarkChesco",

        /* MINIMAP & SCROLL */
        minimap: { enabled: true },
        scrollbar: {
            vertical: "hidden",
            horizontal: "hidden",
            handleMouseWheel: true,
            useShadows: false
        },

        /* ENHANCED ANIMATIONS */
        smoothScrolling: true,
        scrollBeyondLastLine: true,
        cursorSmoothCaretAnimation: true,
        cursorBlinking: "smooth",
        renderLineHighlight: "all", // we still highlight for cursor
        lineHeight: 24,
        fontSize: 16,
        fontLigatures: true,
        automaticLayout: true,
        renderWhitespace: "none",
        folding: true,
        selectionHighlight: true,
        overviewRulerLanes: 3
    });

    editor.getModel().updateOptions({ insertSpaces: true });

    /* Smooth decoration animations */
    const originalDeltaDecorations = editor.deltaDecorations.bind(editor);
    editor.deltaDecorations = (oldDecorations, newDecorations) => {
        newDecorations.forEach(d => {
            if (!d.options.inlineClassName) return;
            const el = document.querySelector(`.${d.options.inlineClassName}`);
            if (el) el.style.transition = "all 0.4s ease-in-out";
        });
        return originalDeltaDecorations(oldDecorations, newDecorations);
    };

    /* Smooth current line highlight animation */
    editor.onDidChangeCursorPosition(() => {
        const lines = document.querySelectorAll(".view-line");
        lines.forEach(line => line.classList.add("current-line"));
        setTimeout(() => lines.forEach(line => line.classList.remove("current-line")), 200);
    });

    /* INTELLISENSE */
    monaco.languages.registerCompletionItemProvider("lua", {
        provideCompletionItems: () => ({ suggestions: Proposals })
    });
});

/* ============================
   INTELLISENSE API
============================ */
function AddIntellisense(label, kindName, detail, insert) {
    const kinds = monaco.languages.CompletionItemKind;
    Proposals.push({
        label,
        kind: kinds[kindName] || kinds.Function,
        detail,
        insertText: insert
    });
}

function AddSnippet(kind, name, data) {
    Proposals.push({
        label: name,
        kind: monaco.languages.CompletionItemKind[kind],
        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
        insertText: Array.isArray(data.insertText) ? data.insertText.join("\n") : data.insertText,
        ...data
    });
}

function AddRawSnippet(obj) {
    Proposals.push(obj);
}

/* ============================
   ERROR HIGHLIGHTING
============================ */
function ShowError(line, col, endline, endcol, msg) {
    editor.revealPositionInCenter({ lineNumber: line, column: col });
    editor.deltaDecorations([], [{
        range: new monaco.Range(line, col, endline, endcol),
        options: {
            inlineClassName: "squiggly-error",
            hoverMessage: { value: msg }
        }
    }]);
}

/* ============================
   GET/SET TEXT
============================ */
function GetText() { return editor.getValue(); }
function SetText(t) { editor.setValue(t); }

</script>

</body>
</html>
